var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,m){b!=Array.prototype&&b!=Object.prototype&&(b[a]=m.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,m,n){if(a){m=$jscomp.global;b=b.split(".");for(n=0;n<b.length-1;n++){var g=b[n];g in m||(m[g]={});m=m[g]}b=b[b.length-1];n=m[b];a=a(n);a!=n&&null!=a&&$jscomp.defineProperty(m,b,{configurable:!0,writable:!0,value:a})}};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},a={};try{return a.__proto__=b,a.a}catch(m){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,a){b.__proto__=a;if(b.__proto__!==a)throw new TypeError(b+" is not extensible");return b}:null;$jscomp.polyfill("Object.setPrototypeOf",function(b){return b||$jscomp.setPrototypeOf},"es6","es5");
var __extends=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var n in b)b.hasOwnProperty(n)&&(a[n]=b[n])};return function(a,m){function n(){this.constructor=a}b(a,m);a.prototype=null===m?Object.create(m):(n.prototype=m.prototype,new n)}}(),Exitgames;
(function(b){(function(a){var b=function(){function a(g,l){void 0===g&&(g="");void 0===l&&(l=a.Level.INFO);this.prefix=g;this.level=l}a.prototype.setPrefix=function(a){this.prefix=a};a.prototype.getPrefix=function(){return this.prefix};a.prototype.setLevel=function(g){g=Math.max(g,a.Level.DEBUG);this.level=g=Math.min(g,a.Level.OFF)};a.setExceptionHandler=function(a){this.exceptionHandler=a};a.prototype.isLevelEnabled=function(a){return a>=this.level};a.prototype.getLevel=function(){return this.level};
a.prototype.debug=function(g){for(var l=[],k=1;k<arguments.length;k++)l[k-1]=arguments[k];this.log(a.Level.DEBUG,g,l)};a.prototype.info=function(g){for(var l=[],k=1;k<arguments.length;k++)l[k-1]=arguments[k];this.log(a.Level.INFO,g,l)};a.prototype.warn=function(g){for(var l=[],k=1;k<arguments.length;k++)l[k-1]=arguments[k];this.log(a.Level.WARN,g,l)};a.prototype.error=function(g){for(var l=[],k=1;k<arguments.length;k++)l[k-1]=arguments[k];this.log(a.Level.ERROR,g,l)};a.prototype.exception=function(g,
l){for(var k=[],b=2;b<arguments.length;b++)k[b-2]=arguments[b];if(!a.exceptionHandler||!a.exceptionHandler(g,this.format0(l,k)))throw Error(this.format0("["+g+"] "+l,k));};a.prototype.format=function(a){for(var g=[],k=1;k<arguments.length;k++)g[k-1]=arguments[k];return this.format0(a,g)};a.prototype.formatArr=function(a,l){return this.format0(a,l)};a.prototype.log=function(g,l,k){if(g>=this.level&&"undefined"!==typeof console&&void 0!==l)try{var b=console[a.log_types[g]];b||(b=console.log);b&&b.apply(console,
[this.prefix,l].concat(k))}catch(q){}};a.prototype.format0=function(a,l){return(""==this.prefix?"":this.prefix+" ")+a+" "+l.map(function(a){if(void 0!==a)switch(typeof a){case "object":try{return JSON.stringify(a)}catch(h){return a.toString()+"("+h+")"}default:return a.toString()}}).join(" ")};a.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,OFF:6};a.log_types=["debug","debug","info","warn","error"];return a}();a.Logger=b;b=function(){function a(){}a.indexOf=function(a,l,k){var g=a.length;for(k=0>k?Math.max(0,
g+k):k||0;k<g;k++)if(a[k]===l)return k;return-1};a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.merge=function(a,l){for(var g in l)l.hasOwnProperty(g)&&(a[g]=l[g])};a.getPropertyOrElse=function(a,l,k){return a.hasOwnProperty(l)?a[l]:k};a.enumValueToName=function(a,l){for(var g in a)if(l==a[g])return g;return"undefined"};a.getEnumKeyByValue=function(a,l){for(var g in a)if(l==a[g])return g};return a}();a.Util=b})(b.Common||(b.Common={}))})(Exitgames||(Exitgames=
{}));var Photon;
(function(b){var a;(function(a){a[a.Ws=0]="Ws";a[a.Wss=1]="Wss"})(a=b.ConnectionProtocol||(b.ConnectionProtocol={}));var m=function(){return function(){}}();b.TypeExtType=m;m=function(){function a(){}a.Is=function(a){return!1};a.Byte=function(a){return a};a.Short=function(a){return a};a.Int=function(a){return a};a.Long=function(a){return a};a.Float=function(a){return a};a.Double=function(a){return a};a.String=function(a){return a};a.Bool=function(a){return a};a.Dict=function(a,l,b){return b};return a}();
b.TypeExt=m;m=function(){function b(a,b,k,h){void 0===k&&(k="");void 0===h&&(h="");this.protocol=a;this.address=b;this.subprotocol=k;this.keepAliveTimeoutMs=3E3;this._frame="~m~";this._isClosing=this._isConnected=this._isConnecting=!1;this._peerStatusListeners={};this._eventListeners={};this._responseListeners={};this.lastRtt=0;this.initTimestamp=Date.now();this.keepAliveTimer=0;this.url=this.addProtocolPrefix(this.address,this.protocol);this._logger=new Exitgames.Common.Logger(h&&""!=h?h+":":"")}
b.prototype.addProtocolPrefix=function(g,b){var l={ws:"ws://",wss:"wss://"},h;for(h in l)if(0==g.indexOf(l[h]))return g;switch(b){case a.Ws:return l.ws+g;case a.Wss:return l.wss+g;default:return l.ws+g}};b.prototype.Destroy=function(){};b.prototype.isConnecting=function(){return this._isConnecting};b.prototype.getLastRtt=function(){return this.lastRtt};b.prototype.isConnected=function(){return this._isConnected};b.prototype.isClosing=function(){return this._isClosing};b.prototype.connect=function(a){var b=
this;this._sessionid=void 0;a=this.url+"/"+a+"?libversion=4.1.0.0";this._socket=""==this.subprotocol?new WebSocket(a,"Json"):new WebSocket(a,this.subprotocol);this._onConnecting();this._socket.onopen=function(a){};this._socket.onmessage=function(a){a=b._decode(a.data);b._onMessage(a.toString())};this._socket.onclose=function(a){b._logger.debug("onclose: wasClean =",a.wasClean,", code=",a.code,", reason =",a.reason);b._isConnecting?b._onConnectFailed(a):(1006==a.code&&b._onTimeout(),b._onDisconnect())};
this._socket.onerror=function(a){b._onError(a)}};b.prototype.disconnect=function(){this._isClosing=!0;this._socket.close()};b.prototype.sendOperation=function(a,b,k,h){a={req:a,vals:[]};Exitgames.Common.Util.isArray(b)?a.vals=b:void 0===b?a.vals=[]:this._logger.exception(201,"PhotonPeer[sendOperation] - Trying to send non array data:",b);this._send(a);this._logger.debug("PhotonPeer[sendOperation] - Sending request:",a)};b.prototype.addPeerStatusListener=function(a,b){this._addListener(this._peerStatusListeners,
a,b)};b.prototype.addEventListener=function(a,b){this._addListener(this._eventListeners,a.toString(),b)};b.prototype.addResponseListener=function(a,b){this._addListener(this._responseListeners,a.toString(),b)};b.prototype.removePeerStatusListener=function(a,b){this._removeListener(this._peerStatusListeners,a,b)};b.prototype.removeEventListener=function(a,b){this._removeListener(this._eventListeners,a.toString(),b)};b.prototype.removeResponseListener=function(a,b){this._removeListener(this._responseListeners,
a.toString(),b)};b.prototype.removePeerStatusListenersForCode=function(a){this._removeListenersForCode(this._peerStatusListeners,a)};b.prototype.removeEventListenersForCode=function(a){this._removeListenersForCode(this._eventListeners,a.toString())};b.prototype.removeResponseListenersForCode=function(a){this._removeListenersForCode(this._responseListeners,a.toString())};b.prototype.setLogLevel=function(a){this._logger.setLevel(a)};b.prototype.onUnhandledEvent=function(a,b){this._logger.warn("PhotonPeer: No handler for event",
a,"registered.")};b.prototype.onUnhandledResponse=function(a,b){this._logger.warn("PhotonPeer: No handler for response",a,"registered.")};b.prototype._dispatchEvent=function(a,b){if(!this._dispatch(this._eventListeners,a.toString(),b,"event"))this.onUnhandledEvent(a,b)};b.prototype._dispatchResponse=function(a,b){if(!this._dispatch(this._responseListeners,a.toString(),b,"response"))this.onUnhandledResponse(a,b)};b.prototype._stringify=function(a){return"[object Object]"==Object.prototype.toString.call(a)?
(JSON||this._logger.exception(202,"PhotonPeer[_stringify] - Trying to encode as JSON, but JSON.stringify is missing."),"~j~"+JSON.stringify(a)):String(a)};b.prototype._encode=function(a){var b="";a=Exitgames.Common.Util.isArray(a)?a:[a];for(var g=0,h=a.length;g<h;g++){var q=null===a[g]||void 0===a[g]?"":this._stringify(a[g]);b+=this._frame+q.length+this._frame+q}return b};b.prototype._decode=function(a){var b=[];var g=a;-1!==a.indexOf("\x00")&&(g=a.replace(/[\0]/g,""));a=g;do{if(a.substr(0,3)!==this._frame)break;
a=a.substr(3);g="";for(var h=0,q=a.length;h<q;h++){var d=Number(a.substr(h,1));if(a.substr(h,1)==d)g+=d;else{a=a.substr(g.length+this._frame.length);g=Number(g);break}}b.push(a.substr(0,g));a=a.substr(g)}while(""!==a);return b};b.prototype._onMessage=function(a){"~j~"==a.substr(0,3)?this._onMessageReceived(JSON.parse(a.substr(3))):this._sessionid?this._onMessageReceived(a):(this._sessionid=a,this._onConnect())};b.prototype.resetKeepAlive=function(){var a=this;clearTimeout(this.keepAliveTimer);1E3<=
this.keepAliveTimeoutMs&&(this.keepAliveTimer=setTimeout(function(){a._send((b={},b.irq=1,b.vals=[1,Date.now()-a.initTimestamp],b),!0);var b},this.keepAliveTimeoutMs))};b.prototype._send=function(a,b){void 0===b&&(b=!1);var g=this._encode(a);this._isConnected&&!this._isClosing?(this.resetKeepAlive(),this._socket.send(g)):b||this._logger.exception(203,"PhotonPeer[_send] - Operation",a.req,'- failed, "isConnected" is',this._isConnected,', "isClosing" is',this._isClosing,"!")};b.prototype._onMessageReceived=
function(a){if("object"===typeof a)if(this._logger.debug("PhotonPeer[_onMessageReceived] - Socket received message:",a),a={err:a.err,msg:a.msg,vals:a.vals,res:a.res,evt:a.evt,irs:a.irs},a.vals=void 0!==a.vals?a.vals:[],0<a.vals.length&&(a.vals=this._parseMessageValuesArrayToJSON(a.vals)),void 0!==a.res){var b=parseInt(a.res);this._parseResponse(b,a)}else void 0!==a.evt?(b=parseInt(a.evt),this._parseEvent(b,a)):void 0!==a.irs?(b=parseInt(a.irs),this._parseInternalResponse(b,a)):this._logger.exception(204,
"PhotonPeer[_onMessageReceived] - Received undefined message type:",a)};b.prototype._parseMessageValuesArrayToJSON=function(a){var b={};if(Exitgames.Common.Util.isArray(a))if(0==a.length%2)for(var g,h;0<a.length;)g=a.shift()+"",h=a.shift(),b[g]=h;else this._logger.exception(205,"PhotonPeer[_parseMessageValuesToJSON] - Received invalid values array:",a);return b};b.prototype._parseEvent=function(a,b){this._dispatchEvent(a,{vals:b.vals})};b.prototype._parseResponse=function(a,b){this._dispatchResponse(a,
{errCode:b.err,errMsg:b.msg,vals:b.vals})};b.prototype._parseInternalResponse=function(a,b){this.lastRtt=Date.now()-this.initTimestamp-b.vals[1];this._logger.debug("internal response:",b)};b.prototype._onConnecting=function(){this._logger.debug("PhotonPeer[_onConnecting] - Starts connecting",this.url,'..., raising "connecting" event ...');this._isConnecting=!0;this._dispatchPeerStatus(b.StatusCodes.connecting);this.resetKeepAlive()};b.prototype._onConnect=function(){this._logger.debug('PhotonPeer[_onConnect] - Connected successfully! Raising "connect" event ...');
this._isConnecting=!1;this._isConnected=!0;this._dispatchPeerStatus(b.StatusCodes.connect);this.resetKeepAlive()};b.prototype._onConnectFailed=function(a){this._logger.error("PhotonPeer[_onConnectFailed] - Socket connection could not be created:",this.url,this.subprotocol,'Wrong host or port?\n Raising "connectFailed event ...');this._isConnecting=this._isConnected=!1;this._dispatchPeerStatus(b.StatusCodes.connectFailed)};b.prototype._onDisconnect=function(){var a=this._isConnected,l=this._isClosing;
this._logger.debug('PhotonPeer[_onDisconnect] - Socket closed, raising "disconnect" event ...');this._isClosing=this._isConnected=this._isConnecting=!1;a&&(l?this._dispatchPeerStatus(b.StatusCodes.disconnect):this._dispatchPeerStatus(b.StatusCodes.connectClosed))};b.prototype._onTimeout=function(){this._logger.debug('PhotonPeer[_onTimeout] - Client timed out! Raising "timeout" event ...');this._dispatchPeerStatus(b.StatusCodes.timeout)};b.prototype._onError=function(a){this._logger.error("PhotonPeer[_onError] - Connection error:",
a);this._isConnecting=this._isConnected=this._isClosing=!1;this._dispatchPeerStatus(b.StatusCodes.error)};b.prototype._addListener=function(a,b,k){b in a||(a[b]=[]);k&&"function"===typeof k?(this._logger.debug("PhotonPeer[_addListener] - Adding listener for event",b),a[b].push(k)):this._logger.error("PhotonPeer[_addListener] - Listener",b,"is not a function but of type",typeof k,". No listener added!");return this};b.prototype._dispatch=function(a,b,k,h){if(b in a){a=a[b];b=0;for(h=a.length;b<h;b++)Exitgames.Common.Util.isArray(k)||
(k=[k]),a[b].apply(this,void 0===k?[]:k);return!0}return!1};b.prototype._dispatchPeerStatus=function(a){this._dispatch(this._peerStatusListeners,a,void 0,"peerStatus")||this._logger.warn("PhotonPeer[_dispatchPeerStatus] - No handler for ",a,"registered.")};b.prototype._removeListener=function(a,b,k){if(b in a){var h=a[b].length;a[b]=a[b].filter(function(a){return a!=k});this._logger.debug("PhotonPeer[_removeListener] - Removing listener for event",b,"removed:",h-a[b].length)}return this};b.prototype._removeListenersForCode=
function(a,b){this._logger.debug("PhotonPeer[_removeListenersForCode] - Removing all listeners for event",b);b in a&&(a[b]=[]);return this};b.StatusCodes={connecting:"connecting",connect:"connect",connectFailed:"connectFailed",disconnect:"disconnect",connectClosed:"connectClosed",error:"error",timeout:"timeout"};return b}();b.PhotonPeer=m})(Photon||(Photon={}));
(function(b){(function(a){var m=function(){function b(a,e,f){this.name=a;this.actorNr=e;this.isLocal=f;this.customProperties={};this.suspended=!1}b.prototype.getRoom=function(){return this.loadBalancingClient.myRoom()};b.prototype.raiseEvent=function(a,e,f){this.loadBalancingClient&&this.loadBalancingClient.raiseEvent(a,e,f)};b.prototype.setName=function(a){this.name=a};b.prototype.onPropertiesChange=function(a,e){};b.prototype.getCustomProperty=function(a){return this.customProperties[a]};b.prototype.getCustomPropertyOrElse=
function(a,e){return Exitgames.Common.Util.getPropertyOrElse(this.customProperties,a,e)};b.prototype.setCustomProperty=function(a,e,f,b){void 0===f&&(f=!1);this.customProperties[a]=e;var c={};c[a]=e;var d;void 0!=b&&(d=(p={},p[a]=b,p));this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,c,f,d);this.onPropertiesChange(c,!0);var p};b.prototype.setCustomProperties=function(a,e,f){void 0===e&&(e=!1);var c={},b;for(b in a)this.customProperties[b]=
a[b],c[b]=a[b];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,c,e,f);this.onPropertiesChange(c,!0)};b.prototype.isSuspended=function(){return this.suspended};b.prototype._getAllProperties=function(){var c={};c[a.Constants.ActorProperties.PlayerName]=this.name;for(var e in this.customProperties)c[e]=this.customProperties[e];return c};b.prototype._setLBC=function(a){this.loadBalancingClient=a};b.prototype._updateFromResponse=
function(c){this.actorNr=c[a.Constants.ParameterCode.ActorNr];c=c[a.Constants.ParameterCode.PlayerProperties];if(void 0!==c){var e=c[a.Constants.ActorProperties.PlayerName];void 0!==e&&(this.name=e);this._updateCustomProperties(c)}};b.prototype._updateMyActorFromResponse=function(c){this.actorNr=c[a.Constants.ParameterCode.ActorNr]};b.prototype._updateCustomProperties=function(a){for(var c in a)this.customProperties[c]=a[c];this.onPropertiesChange(a,!1)};b.prototype._setSuspended=function(a){this.suspended=
a};b._getActorNrFromResponse=function(c){return c[a.Constants.ParameterCode.ActorNr]};return b}();a.Actor=m;var n=function(){function b(a){this.address=this.name="";this.maxPlayers=0;this.isOpen=this.isVisible=!0;this.suspendedPlayerLiveTime=this.emptyRoomLiveTime=this.playerCount=0;this.cleanupCacheOnLeave=this.removed=!1;this.masterClientId=0;this._customProperties={};this._propsListedInLobby=[];this.name=a}b.prototype.onPropertiesChange=function(a,e){};b.prototype.getCustomProperty=function(a){return this._customProperties[a]};
b.prototype.getCustomPropertyOrElse=function(a,e){return Exitgames.Common.Util.getPropertyOrElse(this._customProperties,a,e)};b.prototype._updateFromMasterResponse=function(c){this.address=c[a.Constants.ParameterCode.Address];if(c=c[a.Constants.ParameterCode.RoomName])this.name=c};b.prototype._updateFromProps=function(c){if(c){this.maxPlayers=this.updateIfExists(this.maxPlayers,a.Constants.GameProperties.MaxPlayers,c);this.isVisible=this.updateIfExists(this.isVisible,a.Constants.GameProperties.IsVisible,
c);this.isOpen=this.updateIfExists(this.isOpen,a.Constants.GameProperties.IsOpen,c);this.playerCount=this.updateIfExists(this.playerCount,a.Constants.GameProperties.PlayerCount,c);this.removed=this.updateIfExists(this.removed,a.Constants.GameProperties.Removed,c);this._propsListedInLobby=this.updateIfExists(this._propsListedInLobby,a.Constants.GameProperties.PropsListedInLobby,c);this.cleanupCacheOnLeave=this.updateIfExists(this.cleanupCacheOnLeave,a.Constants.GameProperties.CleanupCacheOnLeave,c);
this.masterClientId=this.updateIfExists(this.masterClientId,a.Constants.GameProperties.MasterClientId,c);this.emptyRoomLiveTime=this.updateIfExists(this.emptyRoomLiveTime,a.Constants.GameProperties.EmptyRoomTtl,c);this.suspendedPlayerLiveTime=this.updateIfExists(this.suspendedPlayerLiveTime,a.Constants.GameProperties.PlayerTtl,c);var e={},f;for(f in c)parseInt(f).toString()!=f&&this._customProperties[f]!==c[f]&&(this._customProperties[f]=c[f],e[f]=c[f]);this.onPropertiesChange(e,!1)}};b.prototype._updateFromEvent=
function(c){c&&(this.masterClientId=this.updateIfExists(this.masterClientId,a.Constants.ParameterCode.MasterClientId,c))};b.prototype.updateIfExists=function(a,e,f){return f.hasOwnProperty(e)?f[e]:a};return b}();a.RoomInfo=n;var g=function(b){function c(a){return b.call(this,a)||this}__extends(c,b);c.prototype.setCustomProperty=function(a,c,b,d){void 0===b&&(b=!1);this._customProperties[a]=c;var e={};e[a]=c;var f;void 0!=d&&(f=(p={},p[a]=d,p));this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&
this.loadBalancingClient._setPropertiesOfRoom(e,b,f);this.onPropertiesChange(e,!0);var p};c.prototype.setCustomProperties=function(a,c,b){void 0===c&&(c=!1);var e={},f;for(f in a)this._customProperties[f]=a[f],e[f]=a[f];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfRoom(e,c,b);this.onPropertiesChange(e,!0)};c.prototype.setProp=function(a,c){if(this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var e={};e[a]=c;this.loadBalancingClient._setPropertiesOfRoom(e,
!1,void 0)}};c.prototype.setIsVisible=function(c){this.isVisible!=c&&(this.isVisible=c,this.setProp(a.Constants.GameProperties.IsVisible,c))};c.prototype.setIsOpen=function(c){this.isOpen!=c&&(this.isOpen=c,this.setProp(a.Constants.GameProperties.IsOpen,c))};c.prototype.setMaxPlayers=function(c){this.maxPlayers!=c&&(this.maxPlayers=c,this.setProp(a.Constants.GameProperties.MaxPlayers,c))};c.prototype.setEmptyRoomLiveTime=function(c){this.emptyRoomLiveTime!=c&&(this.emptyRoomLiveTime=c,this.setProp(a.Constants.GameProperties.EmptyRoomTtl,
c))};c.prototype.setSuspendedPlayerLiveTime=function(c){this.suspendedPlayerLiveTime!=c&&(this.suspendedPlayerLiveTime=c,this.setProp(a.Constants.GameProperties.PlayerTtl,c))};c.prototype.setPlugins=function(a){this.plugins=a};c.prototype.setPropsListedInLobby=function(a){this._propsListedInLobby=a};c.prototype._setLBC=function(a){this.loadBalancingClient=a};return c}(n);a.Room=g;var l=function(){function d(c,e,f){this.appId=e;this.appVersion=f;this.autoJoinLobby=!0;this.connectOptions={};this.createRoomOptions=
{};this.joinRoomOptions={};this.roomInfos=[];this.roomInfosDict={};this.actors={};this.actorsArray=[];this.lowestActorId=0;this.userAuthType=a.Constants.CustomAuthenticationType.None;this.userAuthData=this.userAuthParameters="";this.lobbyStatsRequestList=[];this.state=d.State.Uninitialized;this.logger=new Exitgames.Common.Logger("Client:");this.validNextState={};if("number"==typeof c)switch(this.connectionProtocol=c,c){case b.ConnectionProtocol.Ws:this.masterServerAddress="ws://app-eu.exitgamescloud.com:9090";
this.nameServerAddress="ws://ns.exitgames.com:9093";break;case b.ConnectionProtocol.Wss:this.masterServerAddress="wss://app-eu.exitgamescloud.com:19090";this.nameServerAddress="wss://ns.exitgames.com:19093";break;default:this.nameServerAddress=this.masterServerAddress="wrong_protocol_error",this.logger.error("Wrong protocol: ",c)}else"string"==typeof c?(this.connectionProtocol=b.ConnectionProtocol.Ws,this.nameServerAddress=this.masterServerAddress=c):(this.connectionProtocol=b.ConnectionProtocol.Ws,
this.nameServerAddress=this.masterServerAddress="wrong_protocol_type_error",this.logger.error("Wrong protocol type: ",typeof c));this.initValidNextState();this.currentRoom=this.roomFactoryInternal("");this._myActor=this.actorFactoryInternal("",-1,!0);this.addActor(this._myActor)}d.prototype.onStateChange=function(a){};d.prototype.onError=function(a,e){};d.prototype.onOperationResponse=function(a,e,f,b){};d.prototype.onEvent=function(a,e,f){};d.prototype.onRoomList=function(a){};d.prototype.onRoomListUpdate=
function(a,e,f,b){};d.prototype.onMyRoomPropertiesChange=function(){};d.prototype.onActorPropertiesChange=function(a){};d.prototype.onJoinRoom=function(a){};d.prototype.onActorJoin=function(a){};d.prototype.onActorLeave=function(a,e){};d.prototype.onActorSuspend=function(a){};d.prototype.onFindFriendsResult=function(a,e,f){};d.prototype.onLobbyStats=function(a,e,f){};d.prototype.onAppStats=function(a,e,f){};d.prototype.onGetRegionsResult=function(a,e,f){};d.prototype.onWebRpcResult=function(a,e,f,
b,d){};d.prototype.roomFactory=function(a){return new g(a)};d.prototype.actorFactory=function(a,e,f){return new m(a,e,f)};d.prototype.myActor=function(){return this._myActor};d.prototype.myRoom=function(){return this.currentRoom};d.prototype.myRoomActors=function(){return this.actors};d.prototype.myRoomActorCount=function(){return this.actorsArray.length};d.prototype.myRoomActorsArray=function(){return this.actorsArray};d.prototype.myRoomMasterActorNr=function(){return this.myRoom().masterClientId?
this.myRoom().masterClientId:this.lowestActorId};d.prototype.lastRtt=function(){return this.gamePeer&&this.gamePeer.getLastRtt()};d.prototype.roomFactoryInternal=function(a){void 0===a&&(a="");a=this.roomFactory(a);a._setLBC(this);return a};d.prototype.actorFactoryInternal=function(a,e,f){void 0===a&&(a="");void 0===e&&(e=-1);void 0===f&&(f=!1);a=this.actorFactory(a,e,f);a._setLBC(this);return a};d.prototype.setNameServerAddress=function(a){this.nameServerAddress=a};d.prototype.getNameServerAddress=
function(){return this.nameServerAddress};d.prototype.setMasterServerAddress=function(a){this.masterServerAddress=a};d.prototype.getMasterServerAddress=function(){return this.nameServerAddress};d.prototype.setUserId=function(a){this.userId=a};d.prototype.getUserId=function(){return this.userId};d.prototype.setCustomAuthentication=function(a,e,f){void 0===e&&(e=b.LoadBalancing.Constants.CustomAuthenticationType.Custom);this.userAuthType=e;this.userAuthParameters=a;this.userAuthData=f};d.prototype.connect=
function(a){"boolean"===typeof a&&(a=a?{keepMasterConnection:!0}:{keepMasterConnection:!1});a||(a={});if(this.checkNextState(d.State.ConnectingToMasterserver,!0)){this.changeState(d.State.ConnectingToMasterserver);this.logger.info("Connecting to Master",this.masterServerAddress);this.connectOptions={};for(var c in a)this.connectOptions[c]=a[c];this.masterPeer&&this.masterPeer.Destroy();this.masterPeer=new h(this,this.connectionProtocol,this.masterServerAddress,"");this.initMasterPeer(this.masterPeer);
this.masterPeer.connect(this.appId);return!0}return!1};d.prototype.connectToNameServer=function(a){a||(a={});if(this.checkNextState(d.State.ConnectingToNameServer,!0)){this.changeState(d.State.ConnectingToNameServer);this.logger.info("Connecting to NameServer",this.nameServerAddress);this.connectOptions={};for(var c in a)this.connectOptions[c]=a[c];this.nameServerPeer&&this.nameServerPeer.Destroy();this.nameServerPeer=new k(this,this.connectionProtocol,this.nameServerAddress,"");this.initNameServerPeer(this.nameServerPeer);
this.nameServerPeer.connect(this.appId);return!0}return!1};d.prototype.fillCreateRoomOptions=function(c,e){e=e||{};var f={};void 0!==e.isVisible&&(f[a.Constants.GameProperties.IsVisible]=e.isVisible);void 0!==e.isOpen&&(f[a.Constants.GameProperties.IsOpen]=e.isOpen);void 0!==e.maxPlayers&&(f[a.Constants.GameProperties.MaxPlayers]=e.maxPlayers);void 0!==e.propsListedInLobby&&(f[a.Constants.GameProperties.PropsListedInLobby]=b.TypeExt.String(e.propsListedInLobby));if(void 0!==e.customGameProperties)for(var d in e.customGameProperties)f[d]=
e.customGameProperties[d];c.push(a.Constants.ParameterCode.GameProperties,f);c.push(a.Constants.ParameterCode.CleanupCacheOnLeave,!0);c.push(a.Constants.ParameterCode.Broadcast,!0);void 0!==e.emptyRoomLiveTime&&c.push(a.Constants.ParameterCode.EmptyRoomTTL,b.TypeExt.Int(e.emptyRoomLiveTime));void 0!==e.suspendedPlayerLiveTime&&c.push(a.Constants.ParameterCode.PlayerTTL,b.TypeExt.Int(e.suspendedPlayerLiveTime));void 0!==e.plugins&&c.push(a.Constants.ParameterCode.Plugins,e.plugins);c.push(a.Constants.ParameterCode.CheckUserOnJoin,
!0);e.lobbyName&&(c.push(a.Constants.ParameterCode.LobbyName),c.push(e.lobbyName),void 0!=e.lobbyType&&(c.push(a.Constants.ParameterCode.LobbyType),c.push(e.lobbyType)))};d.prototype.createRoomFromMy=function(a,e){this.currentRoom.name=a?a:"";e=this.copyCreateOptionsFromMyRoom(e);return this.createRoomInternal(this.masterPeer,e)};d.prototype.copyCreateOptionsFromMyRoom=function(a){a=a||{};a.isVisible=this.currentRoom.isVisible;a.isOpen=this.currentRoom.isOpen;a.maxPlayers=this.currentRoom.maxPlayers;
a.customGameProperties=this.currentRoom._customProperties;a.propsListedInLobby=this.currentRoom._propsListedInLobby;a.emptyRoomLiveTime=this.currentRoom.emptyRoomLiveTime;a.suspendedPlayerLiveTime=this.currentRoom.suspendedPlayerLiveTime;a.plugins=this.currentRoom.plugins;return a};d.prototype.createRoom=function(a,e){this.currentRoom=this.roomFactoryInternal(a?a:"");return this.createRoomInternal(this.masterPeer,e)};d.prototype.joinRoom=function(c,e,f){var b=[];e&&(e.createIfNotExists&&(b.push(a.Constants.ParameterCode.JoinMode,
d.JoinMode.CreateIfNotExists),this.fillCreateRoomOptions(b,f)),e.rejoin&&b.push(a.Constants.ParameterCode.JoinMode,d.JoinMode.RejoinOnly));this.currentRoom=this.roomFactoryInternal(c);b.push(a.Constants.ParameterCode.RoomName,c);this.joinRoomOptions=e||{};this.createRoomOptions=f||{};this.logger.info("Join Room",c,e,f,"...");this.masterPeer.sendOperation(a.Constants.OperationCode.JoinGame,b);return!0};d.prototype.joinRandomRoom=function(c){var e=[];if(c){void 0!=c.matchingType&&c.matchingType!=a.Constants.MatchmakingMode.FillRoom&&
(e.push(a.Constants.ParameterCode.MatchMakingType),e.push(c.matchingType));var f={},b=!1;if(void 0!=c.expectedCustomRoomProperties)for(var d in c.expectedCustomRoomProperties)f[d]=c.expectedCustomRoomProperties[d],b=!0;void 0!=c.expectedMaxPlayers&&0<c.expectedMaxPlayers&&(f[a.Constants.GameProperties.MaxPlayers]=c.expectedMaxPlayers,b=!0);b&&(e.push(a.Constants.ParameterCode.GameProperties),e.push(f));c.lobbyName&&(e.push(a.Constants.ParameterCode.LobbyName),e.push(c.lobbyName),void 0!=c.lobbyType&&
(e.push(a.Constants.ParameterCode.LobbyType),e.push(c.lobbyType)));c.sqlLobbyFilter&&(e.push(a.Constants.ParameterCode.Data),e.push(c.sqlLobbyFilter))}this.logger.info("Join Random Room",c&&c.lobbyName,c&&c.lobbyType,"...");this.masterPeer.sendOperation(a.Constants.OperationCode.JoinRandomGame,e);return!0};d.prototype._setPropertiesOfRoom=function(c,e,f){var d=[];d.push(a.Constants.ParameterCode.Properties);d.push(c);d.push(a.Constants.ParameterCode.Broadcast);d.push(!0);e&&(d.push(a.Constants.ParameterCode.WebFlags),
d.push(b.TypeExt.Byte(1)));f&&(d.push(a.Constants.ParameterCode.ExpectedValues),d.push(f));this.gamePeer.sendOperation(a.Constants.OperationCode.SetProperties,d)};d.prototype._setPropertiesOfActor=function(c,e,f,d){var p=[];p.push(a.Constants.ParameterCode.ActorNr);p.push(c);p.push(a.Constants.ParameterCode.Properties);p.push(e);p.push(a.Constants.ParameterCode.Broadcast);p.push(!0);f&&(p.push(a.Constants.ParameterCode.WebFlags),p.push(b.TypeExt.Byte(1)));d&&(p.push(a.Constants.ParameterCode.ExpectedValues),
p.push(d));this.gamePeer.sendOperation(a.Constants.OperationCode.SetProperties,p)};d.prototype.disconnect=function(){this.nameServerPeer&&this.nameServerPeer.disconnect();this._cleanupNameServerPeerData();this.masterPeer&&this.masterPeer.disconnect();this._cleanupMasterPeerData();this.gamePeer&&this.gamePeer.disconnect();this._cleanupGamePeerData();this.changeState(d.State.Disconnected)};d.prototype.suspendRoom=function(c){if(this.isJoinedToRoom()){if(this.gamePeer){var e=[];c&&c.sendAuthCookie&&
e.push(a.Constants.ParameterCode.WebFlags,b.TypeExt.Byte(2));e.push(a.Constants.ParameterCode.IsInactive,!0);this.gamePeer.sendOperation(a.Constants.OperationCode.Leave,e);this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData();this.isConnectedToMaster()?this.changeState(d.State.JoinedLobby):(this.changeState(d.State.Disconnected),this.connect(this.connectOptions))}};d.prototype.leaveRoom=function(c){if(this.isJoinedToRoom()){if(this.gamePeer){var e=[];c&&c.sendAuthCookie&&e.push(a.Constants.ParameterCode.WebFlags,
b.TypeExt.Byte(2));this.gamePeer.sendOperation(a.Constants.OperationCode.Leave,e);this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData();this.isConnectedToMaster()?this.changeState(d.State.JoinedLobby):(this.changeState(d.State.Disconnected),this.connect(this.connectOptions))}};d.prototype.raiseEvent=function(a,e,f){this.isJoinedToRoom()&&this.gamePeer.raiseEvent(a,e,f)};d.prototype.changeGroups=function(a,e){this.isJoinedToRoom()&&(this.logger.debug("Group change:",a,e),this.gamePeer.changeGroups(a,
e))};d.prototype.findFriends=function(a){if(this.isConnectedToMaster())if(a&&"object"==typeof a){this.findFriendsRequestList=[];for(var c=0;c<a.length;++c)if("string"==typeof a[c])this.findFriendsRequestList[c]=a[c];else{this.logger.error("FindFriends request error:","Friend name is not a string",c);this.onFindFriendsResult(-1,"Friend name is not a string "+c,{});return}this.logger.debug("Find friends:",a);this.masterPeer.findFriends(this.findFriendsRequestList)}else this.logger.error("FindFriends request error:",
"Parameter is not an array"),this.onFindFriendsResult(-1,"Parameter is not an array",{});else this.logger.error("FindFriends request error:","Not connected to Master"),this.onFindFriendsResult(d.PeerErrorCode.MasterError,"Not connected to Master",{})};d.prototype.requestLobbyStats=function(c){if(this.isConnectedToMaster()){this.lobbyStatsRequestList=[];if(c)if("object"==typeof c)for(var b=0;b<c.length;++b){var f=c[b];if("object"==typeof f){var p=f[0];if(p){if(void 0===f[1])f=a.Constants.LobbyType.Default;
else if("number"==typeof f[1])f=f[1];else{this.requestLobbyStatsErr("Lobby type is invalid",b);return}this.lobbyStatsRequestList[b]=[p.toString(),f]}else{this.requestLobbyStatsErr("Lobby name is empty",b);return}}else{this.requestLobbyStatsErr("Lobby id is not an array",b);return}}else{this.requestLobbyStatsErr("Parameter is not an array");return}this.masterPeer.requestLobbyStats(this.lobbyStatsRequestList)}else this.logger.error("LobbyState request error:","Not connected to Master"),this.onLobbyStats(d.PeerErrorCode.MasterError,
"Not connected to Master",[])};d.prototype.requestLobbyStatsErr=function(a,b){void 0===b&&(b="");this.logger.error("LobbyState request error:",a,b);this.onLobbyStats(-1,a+" "+b,[])};d.prototype.getRegions=function(){this.isConnectedToNameServer()?(this.logger.debug("GetRegions..."),this.nameServerPeer.getRegions(this.appId)):(this.logger.error("GetRegions request error:","Not connected to NameServer"),this.onGetRegionsResult(d.PeerErrorCode.NameServerError,"Not connected to NameServer",{}))};d.prototype.webRpc=
function(a,b,f){this.isConnectedToMaster()?(this.logger.debug("WebRpc..."),this.masterPeer.webRpc(a,b,f)):this.isJoinedToRoom()?(this.logger.debug("WebRpc..."),this.gamePeer.webRpc(a,b,f)):(this.logger.error("WebRpc request error:","Connected to neither Master nor Game server"),this.onWebRpcResult(d.PeerErrorCode.MasterError,"Connected to neither Master nor Game server",a,0,{}))};d.prototype.connectToRegionMaster=function(a){if(this.isConnectedToNameServer())return this.logger.debug("Connecting to Region Master",
a,"..."),this.nameServerPeer.opAuth(this.appId,this.appVersion,this.userAuthType,this.userAuthParameters,this.userAuthData,this.userId,a),!0;if(this.connectToNameServer({region:a}))return!0;this.logger.error("Connecting to Region Master error:","Not connected to NameServer");return!1};d.prototype.isConnectedToMaster=function(){return this.masterPeer&&this.masterPeer.isConnected()};d.prototype.isConnectedToNameServer=function(){return this.nameServerPeer&&this.nameServerPeer.isConnected()};d.prototype.isInLobby=
function(){return this.state==d.State.JoinedLobby};d.prototype.isJoinedToRoom=function(){return this.state==d.State.Joined};d.prototype.isConnectedToGame=function(){return this.isJoinedToRoom()};d.prototype.availableRooms=function(){return this.roomInfos};d.prototype.setLogLevel=function(a){this.logger.setLevel(a);this.nameServerPeer&&this.nameServerPeer.setLogLevel(a);this.masterPeer&&this.masterPeer.setLogLevel(a);this.gamePeer&&this.gamePeer.setLogLevel(a)};d.prototype.addRoom=function(a){this.roomInfos.push(a);
this.roomInfosDict[a.name]=a};d.prototype.clearRooms=function(){this.roomInfos=[];this.roomInfosDict={}};d.prototype.purgeRemovedRooms=function(){this.roomInfos=this.roomInfos.filter(function(a){return!a.removed});for(var a in this.roomInfosDict)this.roomInfosDict[a].removed&&delete this.roomInfosDict[a]};d.prototype.addActor=function(a){this.actors[a.actorNr]=a;this.actorsArray.push(a);this.currentRoom.playerCount=this.actorsArray.length;if(0==this.lowestActorId||this.lowestActorId>a.actorNr)this.lowestActorId=
a.actorNr};d.prototype.removeActor=function(a){delete this.actors[a];this.actorsArray=this.actorsArray.filter(function(c){return c.actorNr!=a});this.currentRoom.playerCount=this.actorsArray.length;this.lowestActorId==a&&(this.lowestActorId=0<this.actorsArray.length?this.actorsArray.reduce(function(a,c){return a.actorNr<c.actorNr?a:c}).actorNr:0)};d.prototype.clearActors=function(){this.actors={};this.actorsArray=[];this.lowestActorId=this.currentRoom.playerCount=0};d.prototype.changeState=function(a){this.logger.info("State:",
d.StateToName(this.state),"->",d.StateToName(a));this.state=a;this.onStateChange(a)};d.prototype.createRoomInternal=function(c,b){var f=[];this.currentRoom.name&&f.push(a.Constants.ParameterCode.RoomName,this.currentRoom.name);this.fillCreateRoomOptions(f,b);c===this.masterPeer&&(this.createRoomOptions=b);c===this.gamePeer&&(f.push(a.Constants.ParameterCode.PlayerProperties),f.push(this._myActor._getAllProperties()));(c==this.gamePeer?this.gamePeer._logger:this.masterPeer._logger).info("Create Room",
b&&b.lobbyName,b&&b.lobbyType,"...");c.sendOperation(a.Constants.OperationCode.CreateGame,f)};d.prototype.updateUserIdAndNickname=function(c,b){var f=c[a.Constants.ParameterCode.UserId];void 0!=f&&(this.setUserId(f),b.info("Setting userId sent by server:",f));c=c[a.Constants.ParameterCode.Nickname];void 0!=c&&(this.myActor().setName(c),b.info("Setting nickname sent by server:",c))};d.prototype.initNameServerPeer=function(c){var e=this;c.setLogLevel(this.logger.getLevel());c.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,
function(){e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.NameServerError,"NameServer peer error")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.NameServerConnectFailed,"NameServer peer connect failed. "+e.nameServerAddress)});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.NameServerTimeout,"NameServer peer timeout")});
c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connecting,function(){});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){c._logger.info("Connected");e.changeState(d.State.ConnectedToNameServer);void 0!=e.connectOptions.region&&c.opAuth(e.appId,e.appVersion,e.userAuthType,e.userAuthParameters,e.userAuthData,e.userId,e.connectOptions.region)});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){c==e.nameServerPeer&&(e._cleanupNameServerPeerData(),c._logger.info("Disconnected"))});
c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,function(){c._logger.info("Server closed connection");e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.NameServerConnectClosed,"NameServer server closed connection")});c.addResponseListener(a.Constants.OperationCode.GetRegions,function(b){c._logger.debug("resp GetRegions",b);var f={};if(0==b.errCode){var d=b.vals[a.Constants.ParameterCode.Region],k=b.vals[a.Constants.ParameterCode.Address],h;for(h in d)f[d[h]]=k[h]}else c._logger.error("GetRegions request error.",
b.errCode);e.onGetRegionsResult(b.errCode,b.errMsg,f)});c.addResponseListener(a.Constants.OperationCode.Authenticate,function(b){c._logger.debug("resp Authenticate",b);0==b.errCode?(c._logger.info("Authenticated"),c.disconnect(),e.updateUserIdAndNickname(b.vals,c._logger),e.masterServerAddress=b.vals[a.Constants.ParameterCode.Address],c._logger.info("Connecting to Master server",e.masterServerAddress,"..."),e.connectOptions.userAuthSecret=b.vals[a.Constants.ParameterCode.Secret],e.connect(e.connectOptions)):
(e.changeState(d.State.Error),e._onErrorInternal(d.PeerErrorCode.NameServerAuthenticationFailed,"NameServer authentication failed: "+b.errCode+" "+b.errMsg))})};d.prototype.initMasterPeer=function(c){var e=this;c.setLogLevel(this.logger.getLevel());c.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,function(){e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.MasterError,"Master peer error")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){e.changeState(d.State.Error);
e._onErrorInternal(d.PeerErrorCode.MasterConnectFailed,"Master peer connect failed: "+e.masterServerAddress)});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.MasterTimeout,"Master peer error timeout")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connecting,function(){});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){c._logger.info("Connected");var f=[];e.connectOptions.userAuthSecret?(f.push(a.Constants.ParameterCode.Secret,
e.connectOptions.userAuthSecret),c.sendOperation(a.Constants.OperationCode.Authenticate,f),c._logger.info("Authenticate with secret...")):(f.push(a.Constants.ParameterCode.ApplicationId),f.push(e.appId),f.push(a.Constants.ParameterCode.AppVersion),f.push(e.appVersion),e.userAuthType!=a.Constants.CustomAuthenticationType.None&&(f.push(a.Constants.ParameterCode.ClientAuthenticationType,b.TypeExt.Byte(e.userAuthType)),f.push(a.Constants.ParameterCode.ClientAuthenticationParams,e.userAuthParameters),
e.userAuthData&&f.push(a.Constants.ParameterCode.ClientAuthenticationData,e.userAuthData)),e.userId&&f.push(a.Constants.ParameterCode.UserId,e.userId),e.connectOptions.lobbyStats&&f.push(a.Constants.ParameterCode.LobbyStats,!0),c.sendOperation(a.Constants.OperationCode.Authenticate,f),c._logger.info("Authenticate..."))});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){c==e.masterPeer&&(e._cleanupMasterPeerData(),c._logger.info("Disconnected"))});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,
function(){c._logger.info("Server closed connection");e.changeState(d.State.Error);e._onErrorInternal(d.PeerErrorCode.MasterConnectClosed,"Master server closed connection")});c.addEventListener(a.Constants.EventCode.GameList,function(b){b=b.vals[a.Constants.ParameterCode.GameList];e.clearRooms();for(var f in b){var d=new n(f);d._updateFromProps(b[f]);e.addRoom(d)}e.onRoomList(e.roomInfos);c._logger.debug("ev GameList",e.roomInfos,b)});c.addEventListener(a.Constants.EventCode.GameListUpdate,function(b){b=
b.vals[a.Constants.ParameterCode.GameList];var f=[],d=[],k=[],h;for(h in b){var g=e.roomInfos.filter(function(a){return a.name==h});0<g.length?(g=g[0],g._updateFromProps(b[h]),g.removed?k.push(g):f.push(g)):(g=new n(h),g._updateFromProps(b[h]),e.addRoom(g),d.push(g))}e.purgeRemovedRooms();e.onRoomListUpdate(e.roomInfos,f,d,k);c._logger.debug("ev GameListUpdate:",e.roomInfos,"u:",f,"a:",d,"r:",k,b)});c.addResponseListener(a.Constants.OperationCode.Authenticate,function(b){c._logger.debug("resp Authenticate",
b);b.errCode?(e.changeState(d.State.Error),e._onErrorInternal(d.PeerErrorCode.MasterAuthenticationFailed,"Master authentication failed: "+b.errCode+" "+b.errMsg)):(c._logger.info("Authenticated"),e.updateUserIdAndNickname(b.vals,c._logger),void 0!=b.vals[a.Constants.ParameterCode.Secret]&&(e.connectOptions.userAuthSecret=b.vals[a.Constants.ParameterCode.Secret]),e.changeState(d.State.ConnectedToMaster),b=[],e.connectOptions.lobbyName&&(b.push(a.Constants.ParameterCode.LobbyName),b.push(e.connectOptions.lobbyName),
void 0!=e.connectOptions.lobbyType&&(b.push(a.Constants.ParameterCode.LobbyType),b.push(e.connectOptions.lobbyType))),e.autoJoinLobby&&(c.sendOperation(a.Constants.OperationCode.JoinLobby,b),c._logger.info("Join Lobby",e.connectOptions.lobbyName,e.connectOptions.lobbyType,"...")))});c.addResponseListener(a.Constants.OperationCode.JoinLobby,function(b){c._logger.debug("resp JoinLobby",b);b.errCode||(c._logger.info("Joined to Lobby"),e.changeState(d.State.JoinedLobby));e._onOperationResponseInternal2(a.Constants.OperationCode.JoinLobby,
b)});c.addResponseListener(a.Constants.OperationCode.CreateGame,function(b){c._logger.debug("resp CreateGame",b);b.errCode||(e.currentRoom._updateFromMasterResponse(b.vals),c._logger.debug("Created/Joined "+e.currentRoom.name),e.connectToGameServer(a.Constants.OperationCode.CreateGame));e._onOperationResponseInternal2(a.Constants.OperationCode.CreateGame,b)});c.addResponseListener(a.Constants.OperationCode.JoinGame,function(b){c._logger.debug("resp JoinGame",b);b.errCode||(e.currentRoom._updateFromMasterResponse(b.vals),
c._logger.debug("Joined "+e.currentRoom.name),e.connectToGameServer(a.Constants.OperationCode.JoinGame));e._onOperationResponseInternal2(a.Constants.OperationCode.JoinGame,b)});c.addResponseListener(a.Constants.OperationCode.JoinRandomGame,function(b){c._logger.debug("resp JoinRandomGame",b);b.errCode||(e.currentRoom._updateFromMasterResponse(b.vals),c._logger.debug("Joined "+e.currentRoom.name),e.connectToGameServer(a.Constants.OperationCode.JoinRandomGame));e._onOperationResponseInternal2(a.Constants.OperationCode.JoinRandomGame,
b)});c.addResponseListener(a.Constants.OperationCode.FindFriends,function(b){c._logger.debug("resp FindFriends",b);var f={};if(b.errCode)c._logger.error("FindFriends request error:",b.errCode);else for(var d=b.vals[a.Constants.ParameterCode.FindFriendsResponseOnlineList]||{},k=b.vals[a.Constants.ParameterCode.FindFriendsResponseRoomIdList]||{},h=0;h<e.findFriendsRequestList.length;++h){var g=e.findFriendsRequestList[h];g&&(f[g]={online:d[h],roomId:k[h]})}e.onFindFriendsResult(b.errCode,b.errMsg,f)});
c.addResponseListener(a.Constants.OperationCode.LobbyStats,function(b){c._logger.debug("resp LobbyStats",b);var f=[];if(b.errCode)c._logger.error("LobbyStats request error:",b.errCode);else{var d=b.vals[a.Constants.ParameterCode.LobbyName],k=b.vals[a.Constants.ParameterCode.LobbyType]||{},h=b.vals[a.Constants.ParameterCode.PeerCount]||{},g=b.vals[a.Constants.ParameterCode.GameCount]||{};if(d)for(var l=0;l<d.length;++l)f[l]={lobbyName:d[l],lobbyType:k[l],peerCount:h[l],gameCount:g[l]};else for(l=0;l<
e.lobbyStatsRequestList.length;++l)d=e.lobbyStatsRequestList[l],f[l]={lobbyName:d[0],lobbyType:d[1],peerCount:h[l],gameCount:g[l]}}e.onLobbyStats(b.errCode,b.errMsg,f)});c.addEventListener(a.Constants.EventCode.LobbyStats,function(b){c._logger.debug("ev LobbyStats",b);var f=[],d=b.vals[a.Constants.ParameterCode.LobbyName],k=b.vals[a.Constants.ParameterCode.LobbyType]||{},h=b.vals[a.Constants.ParameterCode.PeerCount]||{};b=b.vals[a.Constants.ParameterCode.GameCount]||{};if(d)for(var g=0;g<d.length;++g)f[g]=
{lobbyName:d[g],lobbyType:k[g],peerCount:h[g],gameCount:b[g]};e.onLobbyStats(0,"",f)});c.addEventListener(a.Constants.EventCode.AppStats,function(b){c._logger.debug("ev AppStats",b);e.onAppStats(0,"",{peerCount:b.vals[a.Constants.ParameterCode.PeerCount],masterPeerCount:b.vals[a.Constants.ParameterCode.MasterPeerCount],gameCount:b.vals[a.Constants.ParameterCode.GameCount]})});c.addResponseListener(a.Constants.OperationCode.Rpc,c.webRpcHandler(this))};d.prototype.connectToGameServer=function(a){this.connectOptions.keepMasterConnection||
this.masterPeer.disconnect();return this.checkNextState(d.State.ConnectingToGameserver,!0)?(this.logger.info("Connecting to Game",this.currentRoom.address),this.gamePeer&&this.gamePeer.Destroy(),this.gamePeer=new q(this,this.connectionProtocol,this.currentRoom.address,""),this.gamePeerWaitingForDisconnect=!1,this.initGamePeer(this.gamePeer,a),this.gamePeer.connect(this.appId),this.changeState(d.State.ConnectingToGameserver),!0):!1};d.prototype.initGamePeer=function(c,e){var f=this;c.setLogLevel(this.logger.getLevel());
c.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,function(){f.changeState(d.State.Error);f._onErrorInternal(d.PeerErrorCode.GameError,"Game peer error")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){f.changeState(d.State.Error);f._onErrorInternal(d.PeerErrorCode.GameConnectFailed,"Game peer connect failed: "+f.currentRoom.address)});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){f.changeState(d.State.Error);f._onErrorInternal(d.PeerErrorCode.GameTimeout,
"Game peer timeout")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){c._logger.info("Connected");var e=[];e.push(a.Constants.ParameterCode.ApplicationId);e.push(f.appId);e.push(a.Constants.ParameterCode.AppVersion);e.push(f.appVersion);void 0!=f.connectOptions.userAuthSecret&&(e.push(a.Constants.ParameterCode.Secret),e.push(f.connectOptions.userAuthSecret));f.userAuthType!=a.Constants.CustomAuthenticationType.None&&(e.push(a.Constants.ParameterCode.ClientAuthenticationType),
e.push(b.TypeExt.Byte(f.userAuthType)));f.userId&&e.push(a.Constants.ParameterCode.UserId,f.userId);c.sendOperation(a.Constants.OperationCode.Authenticate,e);c._logger.info("Authenticate...")});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){c==f.gamePeer&&(f._cleanupGamePeerData(),c._logger.info("Disconnected"))});c.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,function(){c._logger.info("Server closed connection");f.gamePeerWaitingForDisconnect||(f.changeState(d.State.Error),
f._onErrorInternal(d.PeerErrorCode.MasterConnectClosed,"Game server closed connection"))});c.addResponseListener(a.Constants.OperationCode.Authenticate,function(b){c._logger.debug("resp Authenticate",b);b.errCode?(f.changeState(d.State.Error),f._onErrorInternal(d.PeerErrorCode.GameAuthenticationFailed,"Game authentication failed: "+b.errCode+" "+b.errMsg)):(c._logger.info("Authenticated"),c._logger.info("Connected"),e==a.Constants.OperationCode.CreateGame?f.createRoomInternal(c,f.createRoomOptions):
(b=[],b.push(a.Constants.ParameterCode.RoomName),b.push(f.currentRoom.name),b.push(a.Constants.ParameterCode.Broadcast),b.push(!0),b.push(a.Constants.ParameterCode.PlayerProperties),b.push(f._myActor._getAllProperties()),e==a.Constants.OperationCode.JoinGame&&(f.joinRoomOptions.createIfNotExists&&(b.push(a.Constants.ParameterCode.JoinMode,d.JoinMode.CreateIfNotExists),f.fillCreateRoomOptions(b,f.createRoomOptions)),f.joinRoomOptions.rejoin&&b.push(a.Constants.ParameterCode.JoinMode,d.JoinMode.RejoinOnly)),
c.sendOperation(a.Constants.OperationCode.JoinGame,b)),f.changeState(d.State.ConnectedToGameserver))});c.addResponseListener(a.Constants.OperationCode.CreateGame,function(b){c._logger.debug("resp CreateGame",b);b.errCode||(f._myActor._updateMyActorFromResponse(b.vals),c._logger.info("myActor: ",f._myActor),f.currentRoom._updateFromProps(b.vals[a.Constants.ParameterCode.GameProperties]),f.clearActors(),f.addActor(f._myActor),f.changeState(d.State.Joined),f.onJoinRoom(!0));f._onOperationResponseInternal2(a.Constants.OperationCode.CreateGame,
b)});c.addResponseListener(a.Constants.OperationCode.JoinGame,function(b){c._logger.debug("resp JoinGame",b);if(!b.errCode){f._myActor._updateMyActorFromResponse(b.vals);c._logger.info("myActor: ",f._myActor);f.clearActors();f.addActor(f._myActor);var e=b.vals[a.Constants.ParameterCode.ActorList],p=b.vals[a.Constants.ParameterCode.PlayerProperties];if(void 0!==e)for(var k=0;k<e.length;k++){var h=e[k],g;void 0!==p&&(g=p[h]);var l;void 0!==g&&(l=g[a.Constants.ActorProperties.PlayerName]);h==f._myActor.actorNr?
h=f._myActor:(h=f.actorFactoryInternal(l,h),f.addActor(h));void 0!==g&&h._updateCustomProperties(g)}f.currentRoom._updateFromProps(b.vals[a.Constants.ParameterCode.GameProperties]);f.changeState(d.State.Joined);f.onJoinRoom(!1)}f._onOperationResponseInternal2(a.Constants.OperationCode.JoinGame,b)});c.addResponseListener(a.Constants.OperationCode.SetProperties,function(b){c._logger.debug("resp SetProperties",b);f._onOperationResponseInternal2(a.Constants.OperationCode.SetProperties,b)});c.addResponseListener(a.Constants.OperationCode.Leave,
function(b){c._logger.debug("resp Leave",b);c.disconnect();f._onOperationResponseInternal2(a.Constants.OperationCode.Leave,b)});c.addResponseListener(a.Constants.OperationCode.Rpc,c.webRpcHandler(this));c.addEventListener(a.Constants.EventCode.Join,function(a){c._logger.debug("ev Join",a);if(m._getActorNrFromResponse(a.vals)===f._myActor.actorNr)f._myActor._updateFromResponse(a.vals),f.onActorJoin(f._myActor);else{var b=f.actorFactoryInternal();b._updateFromResponse(a.vals);f.addActor(b);f.onActorJoin(b)}});
c.addEventListener(a.Constants.EventCode.Leave,function(b){c._logger.debug("ev Leave",b);f.myRoom()._updateFromEvent(b.vals);var e=m._getActorNrFromResponse(b.vals);if(e&&f.actors[e]){var d=f.actors[e];b.vals[a.Constants.ParameterCode.IsInactive]?(d._setSuspended(!0),f.onActorSuspend(d)):(f.removeActor(e),f.onActorLeave(d,!1))}});c.addEventListener(a.Constants.EventCode.Disconnect,function(a){c._logger.debug("ev Disconnect",a);(a=m._getActorNrFromResponse(a.vals))&&f.actors[a]&&(a=f.actors[a],a._setSuspended(!0),
f.onActorSuspend(a))});c.addEventListener(a.Constants.EventCode.PropertiesChanged,function(b){c._logger.debug("ev PropertiesChanged",b);var e=b.vals[a.Constants.ParameterCode.TargetActorNr];void 0!==e&&0<e?void 0!==f.actors[e]&&(e=f.actors[e],e._updateCustomProperties(b.vals[a.Constants.ParameterCode.Properties]),f.onActorPropertiesChange(e)):(f.currentRoom._updateFromProps(b.vals[a.Constants.ParameterCode.Properties]),f.onMyRoomPropertiesChange())})};d.prototype._cleanupNameServerPeerData=function(){};
d.prototype._cleanupMasterPeerData=function(){};d.prototype._cleanupGamePeerData=function(){for(var a in this.actors)this.onActorLeave(this.actors[a],!0);this.clearActors();this.addActor(this._myActor)};d.prototype._onOperationResponseInternal2=function(a,b){b.errCode&&this.logger.warn("Operation",a,"error:",b.errMsg,"("+b.errCode+")");this.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};d.prototype._onErrorInternal=function(a,b){this.logger.error("Error:",a,b);this.onError(a,b)};d.prototype.initValidNextState=
function(){this.validNextState[d.State.Error]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer];this.validNextState[d.State.Uninitialized]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer];this.validNextState[d.State.ConnectedToNameServer]=[d.State.ConnectingToMasterserver];this.validNextState[d.State.Disconnected]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer];this.validNextState[d.State.ConnectedToMaster]=[d.State.JoinedLobby];this.validNextState[d.State.JoinedLobby]=
[d.State.ConnectingToGameserver];this.validNextState[d.State.ConnectingToGameserver]=[d.State.ConnectedToGameserver];this.validNextState[d.State.ConnectedToGameserver]=[d.State.Joined]};d.prototype.checkNextState=function(a,b){void 0===b&&(b=!1);var c=this.validNextState[this.state];(c=c&&0<=c.indexOf(a))||(b?this.logger.error("LoadBalancingPeer checkNextState fail: "+d.StateToName(this.state)+" -> "+d.StateToName(a)):this.logger.exception(501,"LoadBalancingPeer checkNextState fail: "+d.StateToName(this.state)+
" -> "+d.StateToName(a)));return c};d.StateToName=function(a){return Exitgames.Common.Util.getEnumKeyByValue(d.State,a)};d.JoinMode={Default:0,CreateIfNotExists:1,RejoinOnly:3};d.PeerErrorCode={Ok:0,MasterError:1001,MasterConnectFailed:1002,MasterConnectClosed:1003,MasterTimeout:1004,MasterEncryptionEstablishError:1005,MasterAuthenticationFailed:1101,GameError:2001,GameConnectFailed:2002,GameConnectClosed:2003,GameTimeout:2004,GameEncryptionEstablishError:2005,GameAuthenticationFailed:2101,NameServerError:3001,
NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:3005,NameServerAuthenticationFailed:3101};d.State={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToMasterserver:3,ConnectedToMaster:4,JoinedLobby:5,ConnectingToGameserver:6,ConnectedToGameserver:7,Joined:8,Disconnected:10};return d}();a.LoadBalancingClient=l;l=function(d){function c(){return null!==d&&d.apply(this,arguments)||this}__extends(c,d);
c.prototype.webRpc=function(c,d,h){var e=[];e.push(a.Constants.ParameterCode.UriPath,c);e.push(a.Constants.ParameterCode.RpcCallParams,d);h&&h.sendAuthCookie&&e.push(a.Constants.ParameterCode.WebFlags,b.TypeExt.Byte(2));this.sendOperation(a.Constants.OperationCode.Rpc,e)};c.prototype.webRpcHandler=function(b){var c=this;return function(e){c._logger.debug("resp Rpc",e);if(0==e.errCode){var d=e.vals[a.Constants.ParameterCode.UriPath];var f=e.vals[a.Constants.ParameterCode.RpcCallRetData];var h=e.vals[a.Constants.ParameterCode.RpcCallRetCode]}else c._logger.error("WebRpc request error:",
e.errCode);b.onWebRpcResult(e.errCode,e.errMsg,d,h,f)}};return c}(b.PhotonPeer);a.LbcPeer=l;var k=function(d){function c(a,b,c,h){b=d.call(this,b,c,h,a.logger.getPrefix()+" NameServer")||this;b.client=a;return b}__extends(c,d);c.prototype.onUnhandledEvent=function(b,c){this.client.onEvent(b,c.vals[a.Constants.ParameterCode.CustomEventContent],c.vals[a.Constants.ParameterCode.ActorNr])};c.prototype.onUnhandledResponse=function(a,b){this.client.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};c.prototype.getRegions=
function(b){var c=[];c.push(a.Constants.ParameterCode.ApplicationId,b);this.sendOperation(a.Constants.OperationCode.GetRegions,c,!0,0)};c.prototype.opAuth=function(c,d,h,k,g,l,q){var e=[];e.push(a.Constants.ParameterCode.ApplicationId,c);e.push(a.Constants.ParameterCode.AppVersion,d);h!=a.Constants.CustomAuthenticationType.None&&(e.push(a.Constants.ParameterCode.ClientAuthenticationType,b.TypeExt.Byte(h)),e.push(a.Constants.ParameterCode.ClientAuthenticationParams,k),g&&e.push(a.Constants.ParameterCode.ClientAuthenticationData,
g));l&&e.push(a.Constants.ParameterCode.UserId,l);e.push(a.Constants.ParameterCode.Region,q);this.sendOperation(a.Constants.OperationCode.Authenticate,e,!0,0);this._logger.info("Authenticate...")};return c}(l);a.NameServerPeer=k;var h=function(b){function c(a,c,d,h){c=b.call(this,c,d,h,a.logger.getPrefix()+" Master")||this;c.client=a;return c}__extends(c,b);c.prototype.onUnhandledEvent=function(b,c){this.client.onEvent(b,c.vals[a.Constants.ParameterCode.CustomEventContent],c.vals[a.Constants.ParameterCode.ActorNr])};
c.prototype.onUnhandledResponse=function(a,b){this.client.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};c.prototype.findFriends=function(b){var c=[];c.push(a.Constants.ParameterCode.FindFriendsRequestList);c.push(b);this.sendOperation(a.Constants.OperationCode.FindFriends,c)};c.prototype.requestLobbyStats=function(b){var c=[];if(b&&0<b.length){for(var e=[],d=[],h=0;h<b.length;++h)e[h]=b[h][0],d[h]=b[h][1];c.push(a.Constants.ParameterCode.LobbyName);c.push(e);c.push(a.Constants.ParameterCode.LobbyType);
c.push(d)}this.sendOperation(a.Constants.OperationCode.LobbyStats,c)};return c}(l);a.MasterPeer=h;var q=function(d){function c(a,b,c,h){b=d.call(this,b,c,h,a.logger.getPrefix()+" Game")||this;b.client=a;return b}__extends(c,d);c.prototype.onUnhandledEvent=function(b,c){this.client.onEvent(b,c.vals[a.Constants.ParameterCode.CustomEventContent],c.vals[a.Constants.ParameterCode.ActorNr])};c.prototype.onUnhandledResponse=function(a,b){this.client.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};c.prototype.raiseEvent=
function(c,d,h){if(this.client.isJoinedToRoom())this._logger.debug("raiseEvent",c,d,h),c=[a.Constants.ParameterCode.Code,b.TypeExt.Byte(c),a.Constants.ParameterCode.Data,d],h&&(void 0!=h.receivers&&h.receivers!==a.Constants.ReceiverGroup.Others&&(c.push(a.Constants.ParameterCode.ReceiverGroup),c.push(b.TypeExt.Byte(h.receivers))),void 0!=h.cache&&h.cache!==a.Constants.EventCaching.DoNotCache&&(c.push(a.Constants.ParameterCode.Cache),c.push(b.TypeExt.Byte(h.cache))),void 0!=h.interestGroup&&(this.checkGroupNumber(h.interestGroup)?
(c.push(a.Constants.ParameterCode.Group),c.push(b.TypeExt.Byte(h.interestGroup))):this._logger.exception(502,"raiseEvent - Group not a number: "+h.interestGroup)),void 0!=h.targetActors&&(c.push(a.Constants.ParameterCode.ActorList),c.push(h.targetActors)),h.webForward&&(c.push(a.Constants.ParameterCode.WebFlags),c.push(b.TypeExt.Byte(1)))),this.sendOperation(a.Constants.OperationCode.RaiseEvent,c);else throw Error("raiseEvent - Not joined!");};c.prototype.changeGroups=function(c,d){var e=[];null!=
c&&void 0!=c&&(this.checkGroupArray(c,"groupsToRemove"),e.push(a.Constants.ParameterCode.Remove),e.push(b.TypeExt.Byte(c)));null!=d&&void 0!=d&&(this.checkGroupArray(d,"groupsToAdd"),e.push(a.Constants.ParameterCode.Add),e.push(b.TypeExt.Byte(d)));this.sendOperation(a.Constants.OperationCode.ChangeGroups,e)};c.prototype.checkGroupNumber=function(a){return!("number"!=typeof a||isNaN(a)||Infinity===a||-Infinity===a)};c.prototype.checkGroupArray=function(a,b){if(Exitgames.Common.Util.isArray(a))for(var c=
0;c<a.length;++c){var d=a[c];this.checkGroupNumber(d)||this._logger.exception(503,"changeGroups - "+b+" ("+a+") not an array of numbers: element "+c+" = "+d)}else this._logger.exception(504,"changeGroups - groupsToRemove not an array: "+a)};return c}(l);a.GamePeer=q})(b.LoadBalancing||(b.LoadBalancing={}))})(Photon||(Photon={}));
(function(b){b=b.Lite||(b.Lite={});b=b.Constants||(b.Constants={});b.LiteOpKey={ActorList:252,ActorNr:254,ActorProperties:249,Add:238,Broadcast:250,Cache:247,Code:244,Data:245,GameId:255,GameProperties:248,Group:240,Properties:251,ReceiverGroup:246,Remove:239,TargetActorNr:253,EmptyRoomLiveTime:236};b.LiteEventCode={Join:255,Leave:254,PropertiesChanged:253};b.LiteOpCode={ChangeGroups:248,GetProperties:251,Join:255,Leave:254,RaiseEvent:253,SetProperties:252}})(Photon||(Photon={}));
(function(b){var a=b.LoadBalancing||(b.LoadBalancing={});a=a.Constants||(a.Constants={});var m=b.Lite.Constants.LiteOpKey,n=b.Lite.Constants.LiteOpCode;b=b.Lite.Constants.LiteEventCode;a.ErrorCode={Ok:0,OperationNotAllowedInCurrentState:-3,InvalidOperationCode:-2,InternalServerError:-1,InvalidAuthentication:32767,GameIdAlreadyExists:32766,GameFull:32765,GameClosed:32764,NoRandomMatchFound:32760,GameDoesNotExist:32758,MaxCcuReached:32757,InvalidRegion:32756,CustomAuthenticationFailed:32755,AuthenticationTicketExpired:32753,
PluginReportedError:32752,PluginMismatch:32751,JoinFailedPeerAlreadyJoined:32750,JoinFailedFoundInactiveJoiner:32749,JoinFailedWithRejoinerNotFound:32748,JoinFailedFoundExcludedUserId:32747,JoinFailedFoundActiveJoiner:32746,HttpLimitReached:32745,ExternalHttpCallFailed:32744,SlotError:32742,InvalidEncryptionParameters:32741};a.ActorProperties={PlayerName:255};a.GameProperties={MaxPlayers:255,IsVisible:254,IsOpen:253,PlayerCount:252,Removed:251,PropsListedInLobby:250,CleanupCacheOnLeave:249,MasterClientId:248,
PlayerTtl:246,EmptyRoomTtl:245};a.EventCode={GameList:230,GameListUpdate:229,QueueState:228,AppStats:226,AzureNodeInfo:210,Join:b.Join,Leave:b.Leave,PropertiesChanged:b.PropertiesChanged,Disconnect:252,LobbyStats:224};a.ParameterCode={Address:230,PeerCount:229,GameCount:228,MasterPeerCount:227,UserId:225,ApplicationId:224,Position:223,MatchMakingType:223,GameList:222,Secret:221,AppVersion:220,AzureNodeInfo:210,AzureLocalNodeId:209,AzureMasterNodeId:208,RoomName:m.GameId,Broadcast:m.Broadcast,ActorList:m.ActorList,
ActorNr:m.ActorNr,PlayerProperties:m.ActorProperties,CustomEventContent:m.Data,Data:m.Data,Code:m.Code,GameProperties:m.GameProperties,Properties:m.Properties,TargetActorNr:m.TargetActorNr,ReceiverGroup:m.ReceiverGroup,Cache:m.Cache,CleanupCacheOnLeave:241,Group:m.Group,Remove:m.Remove,Add:m.Add,EmptyRoomTTL:m.EmptyRoomLiveTime,PlayerTTL:235,Plugins:204,ClientAuthenticationType:217,ClientAuthenticationParams:216,ClientAuthenticationData:214,JoinMode:215,MasterClientId:203,FindFriendsRequestList:1,
FindFriendsResponseOnlineList:1,FindFriendsResponseRoomIdList:2,LobbyName:213,LobbyType:212,LobbyStats:211,Region:210,IsInactive:233,CheckUserOnJoin:232,ExpectedValues:231,UriPath:209,RpcCallParams:208,RpcCallRetCode:207,RpcCallRetMessage:206,RpcCallRetData:208,WebFlags:234,Nickname:202};a.OperationCode={Authenticate:230,JoinLobby:229,LeaveLobby:228,CreateGame:227,JoinGame:226,JoinRandomGame:225,Leave:n.Leave,RaiseEvent:n.RaiseEvent,SetProperties:n.SetProperties,GetProperties:n.GetProperties,ChangeGroups:n.ChangeGroups,
FindFriends:222,LobbyStats:221,GetRegions:220,Rpc:219};a.MatchmakingMode={FillRoom:0,SerialMatching:1,RandomMatching:2};a.EventCaching={DoNotCache:0,MergeCache:1,ReplaceCache:2,RemoveCache:3,AddToRoomCache:4,AddToRoomCacheGlobal:5,RemoveFromRoomCache:6,RemoveFromRoomCacheForActorsLeft:7};a.ReceiverGroup={Others:0,All:1,MasterClient:2};a.CustomAuthenticationType={Custom:0,Steam:1,Facebook:2,None:255};a.LobbyType={Default:0,SqlLobby:2}})(Photon||(Photon={}));
(function(b){(function(a){(function(a){a.ParameterCode={Channels:0,Channel:1,Messages:2,Message:3,Senders:4,Sender:5,ChannelUserCount:6,UserId:225,MsgId:8,MsgIds:9,SubscribeResults:15,Status:10,Friends:11,SkipMessage:12,HistoryLength:14,WebFlags:21};a.OperationCode={Subscribe:0,Unsubscribe:1,Publish:2,SendPrivate:3,ChannelHistory:4,UpdateStatus:5,AddFriendds:6,RemoveFriends:7};a.EventCode={ChatMessages:0,Users:1,PrivateMessage:2,FriendsList:3,StatusUpdate:4,Subscribe:5,Unsubscribe:6};a.UserStatus=
{Offline:0,Invisible:1,Online:2,Away:3,Dnd:4,Lfg:5,Playing:6};a.UserStatusToName=function(b){return Exitgames.Common.Util.getEnumKeyByValue(a.UserStatus,b)}})(a.Constants||(a.Constants={}))})(b.Chat||(b.Chat={}))})(Photon||(Photon={}));
(function(b){(function(a){var m=function(){function a(a,b){this.sender=a;this.content=b}a.prototype.getSender=function(){return this.sender};a.prototype.getContent=function(){return this.content};return a}();a.Message=m;var n=function(){function a(a,b){this.name=a;this.isPrivat=b;this.messages=[]}a.prototype.getName=function(){return this.name};a.prototype.isPrivate=function(){return this.isPrivat};a.prototype.getMessages=function(){return this.messages};a.prototype.getLastId=function(){return this.lastId};
a.prototype.clearMessages=function(){this.messages.splice(0)};a.prototype.addMessages=function(a,b){var h=[],d;for(d in a)if(parseInt(d)<b.length){var c=new m(a[d],b[d]);this.messages.push(c);h.push(c)}return h};return a}();a.Channel=n;var g=function(g){function k(a,b,d){a=g.call(this,a,b,d)||this;a.publicChannels={};a.privateChannels={};a.subscribeRequests=[];a.unsubscribeRequests=[];a.autoJoinLobby=!1;return a}__extends(k,g);k.prototype.onStateChange=function(a){};k.prototype.onError=function(a,
b){};k.prototype.onSubscribeResult=function(a){};k.prototype.onUnsubscribeResult=function(a){};k.prototype.onChatMessages=function(a,b){};k.prototype.onPrivateMessage=function(a,b){};k.prototype.onUserStatusUpdate=function(a,b,d,c){};k.prototype.connectToRegionFrontEnd=function(a){return this.connectToRegionMaster(a)};k.prototype.isConnectedToFrontEnd=function(){return this.state==k.ChatState.ConnectedToFrontEnd};k.prototype.subscribe=function(h,g){"number"==typeof g&&(g={historyLength:g});if(this.isConnectedToFrontEnd()){this.logger.debug("Subscribe channels:",
h);var d=[];d.push(a.Constants.ParameterCode.Channels,b.TypeExt.String(h));g&&(g.historyLength&&d.push(a.Constants.ParameterCode.HistoryLength,b.TypeExt.Int(g.historyLength)),g.lastIds&&(d.push(a.Constants.ParameterCode.MsgIds,b.TypeExt.Int(g.lastIds)),void 0===g.historyLength&&d.push(a.Constants.ParameterCode.HistoryLength,b.TypeExt.Int(-1))));this.masterPeer.sendOperation(a.Constants.OperationCode.Subscribe,d);return!0}this.logger.error("subscribe request error:","Not connected to Front End");return!1};
k.prototype.unsubscribe=function(h){if(this.isConnectedToFrontEnd()){this.logger.debug("Unsubscribe channels:",h);var g=[];g.push(a.Constants.ParameterCode.Channels,b.TypeExt.String(h));this.masterPeer.sendOperation(a.Constants.OperationCode.Unsubscribe,g);return!0}this.logger.error("unsubscribe request error:","Not connected to Front End");return!1};k.prototype.publishMessage=function(h,g,d){if(this.isConnectedToFrontEnd()){var c=[];c.push(a.Constants.ParameterCode.Channel,h);c.push(a.Constants.ParameterCode.Message,
g);d&&d.webForward&&(c.push(a.Constants.ParameterCode.WebFlags),c.push(b.TypeExt.Byte(1)));this.masterPeer.sendOperation(a.Constants.OperationCode.Publish,c);return!0}this.logger.error("publishMessage request error:","Not connected to Front End");return!1};k.prototype.sendPrivateMessage=function(h,g,d){if(this.isConnectedToFrontEnd()){var c=[];c.push(a.Constants.ParameterCode.UserId,h);c.push(a.Constants.ParameterCode.Message,g);d&&d.webForward&&(c.push(a.Constants.ParameterCode.WebFlags),c.push(b.TypeExt.Byte(1)));
this.masterPeer.sendOperation(a.Constants.OperationCode.SendPrivate,c);return!0}this.logger.error("sendPrivateMessage request error:","Not connected to Front End");return!1};k.prototype.setUserStatus=function(h,g,d){void 0===g&&(g=null);void 0===d&&(d=!1);if(this.isConnectedToFrontEnd()){var c=[];c.push(a.Constants.ParameterCode.Status,b.TypeExt.Int(h));d?c.push(a.Constants.ParameterCode.SkipMessage,!0):c.push(a.Constants.ParameterCode.Message,g);this.masterPeer.sendOperation(a.Constants.OperationCode.UpdateStatus,
c);return!0}this.logger.error("setUserStatus request error:","Not connected to Front End");return!1};k.prototype.addFriends=function(g){if(this.isConnectedToFrontEnd()){var h=[];h.push(a.Constants.ParameterCode.Friends,b.TypeExt.String(g));this.masterPeer.sendOperation(a.Constants.OperationCode.AddFriendds,h);return!0}this.logger.error("addFriends request error:","Not connected to Front End");return!1};k.prototype.removeFriends=function(g){if(this.isConnectedToFrontEnd()){var h=[];h.push(a.Constants.ParameterCode.Friends,
b.TypeExt.String(g));this.masterPeer.sendOperation(a.Constants.OperationCode.RemoveFriends,h);return!0}this.logger.error("removeFriends request error:","Not connected to Front End");return!1};k.prototype.getPublicChannels=function(){return this.publicChannels};k.prototype.getPrivateChannels=function(){return this.privateChannels};k.prototype.getOrAddChannel=function(a,b,d){void 0==a[b]&&(a[b]=new n(b,d));return a[b]};k.prototype.initMasterPeer=function(b){var h=this;g.prototype.initMasterPeer.call(this,
b);b.addEventListener(a.Constants.EventCode.ChatMessages,function(d){var c=d.vals[a.Constants.ParameterCode.Senders],e=d.vals[a.Constants.ParameterCode.Messages],f=d.vals[a.Constants.ParameterCode.Channel],g=h.publicChannels[f];g?(c=g.addMessages(c,e),g.lastId=d.vals[a.Constants.ParameterCode.MsgId],h.onChatMessages(f,c)):b._logger.warn("ev ChatMessages: Got message from unsubscribed channel ",f)});b.addEventListener(a.Constants.EventCode.PrivateMessage,function(b){var c=b.vals[a.Constants.ParameterCode.Sender],
d=b.vals[a.Constants.ParameterCode.Message],f=b.vals[a.Constants.ParameterCode.UserId];f=h.getUserId()==c?f:c;h.getOrAddChannel(h.privateChannels,f,!0).lastId=b.vals[a.Constants.ParameterCode.MsgId];h.onPrivateMessage(f,new m(c,d))});b.addEventListener(a.Constants.EventCode.StatusUpdate,function(b){var c=b.vals[a.Constants.ParameterCode.Message];h.onUserStatusUpdate(b.vals[a.Constants.ParameterCode.Sender],b.vals[a.Constants.ParameterCode.Status],void 0!==c,c)});b.addEventListener(a.Constants.EventCode.Subscribe,
function(d){b._logger.debug("ev Subscribe",d);var c={},e=d.vals[a.Constants.ParameterCode.Channels]||[];d=d.vals[a.Constants.ParameterCode.SubscribeResults]||[];for(var f in e){var g=e[f];c[g]=!1;f<d.length&&d[f]&&(h.getOrAddChannel(h.publicChannels,g,!1),c[g]=!0)}h.onSubscribeResult(c)});b.addEventListener(a.Constants.EventCode.Unsubscribe,function(d){b._logger.debug("ev Unsubscribe",d);var c={};d=d.vals[a.Constants.ParameterCode.Channels]||[];for(var e in d){var f=d[e];delete h.publicChannels[f];
c[f]=!0}h.onUnsubscribeResult(c)})};k.StateToName=function(a){var b=Exitgames.Common.Util.getEnumKeyByValue(k.ChatState,a);return void 0===b?Exitgames.Common.Util.getEnumKeyByValue(k.State,a):b};k.ChatPeerErrorCode={Ok:0,FrontEndError:1001,FrontEndConnectFailed:1002,FrontEndConnectClosed:1003,FrontEndTimeout:1004,FrontEndEncryptionEstablishError:1005,FrontEndAuthenticationFailed:1101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:300,
NameServerAuthenticationFailed:3101};k.ChatState={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToFrontEnd:3,ConnectedToFrontEnd:4,Disconnected:10};return k}(b.LoadBalancing.LoadBalancingClient);a.ChatClient=g})(b.Chat||(b.Chat={}))})(Photon||(Photon={}));
